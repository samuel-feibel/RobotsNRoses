<!DOCTYPE html>
<!--
Template Name: Kelaby
Author: <a href="http://www.os-templates.com/">OS Templates</a>
Author URI: http://www.os-templates.com/
Licence: Free to use under our free template licence terms
Licence URI: http://www.os-templates.com/template-terms
-->
<html>
<head>
<title>Lab 3</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link href="../layout/styles/layout.css" rel="stylesheet" type="text/css" media="all">
</head>
<body id="top">
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<div class="wrapper row2">
  <nav id="mainav" class="hoc clear"> 
    <!-- ################################################################################################ -->
    <ul class="clear">
      <li><a href="../index.html">Home</a></li>
      <li class="active"><a class="drop" href="#">Pages</a>
        <ul>
          <li class="active"><a href="Labs.html">Labs</a></li>
          <li><a href="Milestones.html">Milestones</a></li>
          <li><a href="Team.html">Team</a></li>
          <li><a href="Documents.html">Documents</a></li>
        </ul>
      </li>
      <li><a href="#">Gallery</a></li>
      <li><a href="#">Random Stuff</a></li>
    </ul>
    <!-- ################################################################################################ -->
  </nav>
</div>
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<div class="bgded overlay" style="background-image:url('./images/demo/backgrounds/logo.PNG');">
  <div id="breadcrumb" class="hoc clear"> 
    <!-- ################################################################################################ -->
    <h6 class="heading">Robots 'N' Roses</h6>
    <!-- ################################################################################################ -->
    <!-- ################################################################################################ -->
  </div>
</div>
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<div class="wrapper row4">
  <footer id="footer" class="hoc clear"> 
    <div class="content"> 
      <!-- ################################################################################################ -->
      <h1><b>Goal</b></h1>
      <p>The goal of this lab was to implement a radio communication system to our robot. This allowed it to follow a maze and broadcast its position as well as map the maze on a separate GUI. We added this to our original system so that it was still capable of robot detection, 660 Hz triggering, and line following.</p>
      </div>
    <!-- ################################################################################################ -->
  </footer>
</div>
<div class="wrapper row4">
  <footer id="footer" class="hoc clear"> 
    <div class="content">
      <h1><b>Materials</b></h1>
      <p>          2x Arduino Uno</p>
      <p>          2x Nordic nRF24L01 + Transceivers</p>
      <p>          2x USB A/B Cables </p>
      <p>          2x Radio Breakout Boards with Headers</p>
      </div>
    <!-- ################################################################################################ -->
  </footer>
<div class="wrapper row4">
  <footer id="footer" class="hoc clear"> 
    <div class="content">
      <h1><b>Communicating the Entire Maze</b></h1>
      <p>Storing Maze Information</p>
      <img class="imgr borderedbox inspace-5" src="../images/demo/mazecode1.PNG" alt=""> 
      <p>Figure 1: variables to encode maze info</p>
      <p>We used dir to store the absolute direction the robot is facing. pos stores the robot’s position in x, y coordinates in the maze (Figure 1). curr_pos stores the robot’s current position in x, y coordinates in the maze. We use a 4 element array, walls, to store which walls are present at the current position. For example, if there is a wall to the East at cur_pos, walls[E] will be set to: </p>
      <img class="imgr borderedbox inspace-5" src="../images/demo/mazecode2.PNG" alt="">
      <p>Figure 2: determining the absolute directions of left and right</p>
      <p>We determine the absolute direction of left and right using an enum with the absolute directions: E = 0, S = 1, W = 2, and N = 3. For example, if right_wall = W, if the robot turned right, it would be facing West (Figure 2). </p>
      <img class="imgr borderedbox inspace-5" src="../images/demo/mazecode3.PNG" alt="">
      <p>Figure 3: Right wall following (right wall sensor only)</p>
      <p>We used right wall following to navigate the maze (Figure 3). While the robot is at an intersection, if it detects a wall to its right, the robot will turn right. It will update dir to turn right if no wall was detected to the right.
Using the updated direction variable (dir), we calculate the robot’s next position in the maze. Using coordinates (0, 0) as the upper left corner of the maze, we increment/decrement the x position if dir is East/West and increment/decrement the y position if dir is South/North. </p>
      <img class="imgr borderedbox inspace-5" src="../images/demo/mazecode4.PNG" alt="">
      <p>Figure 4: Full Maze logic (all wall sensors: front, right, and left)</p>
      <p>Figure 4 shows full right wall following logic after integrating the front and left wall sensors. If walls are detected from all three sensors, the robot makes a uturn. If walls are detected in the front and to the right, the robot will turn left. If a wall is detected to the right only, the robot will move forward. If no walls or walls in the front and/or left are detected, the robot will turn right. </p>
    </div>
    <!-- ################################################################################################ -->
  </footer>
</div>
  <div class="wrapper row4">
  <footer id="footer" class="hoc clear"> 
    <div class="content">
      <h1><b>Establishing Connection</b></h1>
      <img class="imgr borderedbox inspace-5" src="../images/demo/mazecode5.png" alt="">  
      <p>Figure 5: radio setup</p>
      <p>Figure 5 shows our setup code for radio communication. We took the code from the “ping out” role in GettingStarted.ino to set up the transmitter arduino (Figure 5).  
    We used pipes 42 and 43 calculated from the formula: 2(3D + N) + X where D = 3, N = 24. </p>
    <img class="imgr borderedbox inspace-5" src="../images/demo/mazecode6.png" alt="">  
    <p>Figure 6: Maze encoding</p>
    <p>We used the 4 least significant bits to encode the ‘y’ position, the next four to encode the ‘x’ position. The next four to encode the East, South, West, North wall at position x, y in that order. A visual of the encoding is shown below. We send the value below when we detect an intersection.</p>
    <img class="imgr borderedbox inspace-5" src="../images/demo/mazecode7.png" alt="">
    <p>Figure 7: Decoding in Base Arduino</p>
    <p>The base arduino receives the transmitted value via radio.read(). The value received is decoded, and the GUI is updated by printing a string:
“2,3,west=false,north=true,east=false,south=false”
Which is created by _print (Figure 8).</p>
   </div>
    <!-- ################################################################################################ -->
  </footer>
</div>
<div class="wrapper row4">
  <footer id="footer" class="hoc clear"> 
    <div class="content">    
      <h1><b>Integration</b></h1>
     <p> We combined the RF code with our maze following code. In order to demonstrated the RF, robot detection, and decoy disregarding, we ran the same system on the same maze 3 times, introducing each feature each time. 

The following is the robot broadcasting and following a maze using the right hand wall following method.</p>
<MAZE FOLLOWING>
<p>Next we had it detect an IR hat and stop.</p>
<IRHAT>
<p>Finally, we had the system disregard a decoy IR frequency.</p>
<DECOY>
<p>For most of our lab session, maze materials were scarce. However, we were able to verify our system on a more complicated maze.</p>
    <COMPLEXMAZE>
    </div>
    <!-- ################################################################################################ -->
  </footer>
</div>
<div class="wrapper row4">
  <footer id="footer" class="hoc clear"> 
    <div class="content"> 
      <h1><b>Software Procedure - Logic to Detect 660 Hz Signal</b></h1>
      </p>From our previous test, we found that the output of bin 5 corresponds to the 660Hz signal. To detect the 660Hz signal, we checked if the value at bin 5 (fft_log_out[4]) is greater than a threshold value 185 (Figure 4). To prevent false starts, we check if the machine constantly detects 660Hz by incrementing a counter if the signal is detected. The counter is reset if the signal was not detected during a cycle. If the signal is detected 10 cycles in a row, we will set flag to start the robot. Temporarily, we set the code to print “detected 660 Hz signal” in place of starting the robot</p>
      <img class="imgr borderedbox inspace-5" src="../images/demo/asoftware2.png" alt=""> 
  <p><b>Working Microphone Detecting 660 Hz</b></p>
  <p><b>Unfortunately, files bigger than 25 MB can't be uploaded to Github. Here's a link instead:</b></p>
  <li><a href="https://drive.google.com/file/d/1CY3cq-2nk4PQZJi8-MHCE5ZBsCJ1Gd7X/view?usp=sharing">Microphone Detecting 660 HZ Signal</a></li>
  <p>(I will resolve this problem shortly, as soon as I get better wifi than starbucks so I can actually run the pixel reducer online)</p>
  </div>
    <!-- ################################################################################################ -->
  </footer>
</div>
  <div class="wrapper row4">
  <footer id="footer" class="hoc clear"> 
    <div class="content">
      <h1><b>Optical Signal Processing</b></h1>
      </div>
    <!-- ################################################################################################ -->
  </footer>
</div>
  <div class="wrapper row4">
  <footer id="footer" class="hoc clear"> 
    <div class="content">    
      <h1><b>Materials</b></h1>
      <p>Arduino Uno</p> 
      <p>IR transistor (OP598)</p> 
      <p>IR hat</p> 
      <p>IR decoy</p> 
      <p>LM358 Op-Amp</p> 
      <p>Various Resistors</p> 
      <p>Breadboards</p> 
     <p> Wiring</p> 
      
      </div>
    <!-- ################################################################################################ -->
  </footer>
</div>
  <div class="wrapper row4">
  <footer id="footer" class="hoc clear"> 
    <div class="content">    
      <h1><b>Hardware Procedure</b></h1>
      <p>We began by investigating how well we could read infrared light through our sensor. The circuit for this is shown below. The sensor used is a phototransistor which will pass more current when the more infrared light is hitting it. This means that in the absence of infrared, Vout will read 0V while when the phototransistor is saturated, it would read 5V. By hooking up this circuit to power and attaching an oscilloscope probe to Vout, we were able to read the frequency and amplitude of this signal. </p>       
      <img class="imgr borderedbox inspace-5" src="../images/demo/irhardware1.png" alt="">
     </div>
    <!-- ################################################################################################ -->
  </footer>
</div>
  <div class="wrapper row4">
  <footer id="footer" class="hoc clear"> 
    <div class="content">    
      <h1><b>Hardware Procedure</b></h1>
      <p>We decided that we’d only need to detect treasures within 6 inches to 18 inches away from our robot, so we held infrared sources these distances away, oriented so that the photodiode could read them. The oscilloscope reading at these distances is shown below. The IR hat is outputting a frequency of 6.08kHz.</p>       
      <img class="imgr borderedbox inspace-5" src="../images/demo/irhardware2.png" alt="">
    </div>
    <!-- ################################################################################################ -->
  </footer>
</div>
  <div class="wrapper row4">
  <footer id="footer" class="hoc clear"> 
    <div class="content">    
      <h1><b>Hardware Procedure</b></h1>
      <p>Within our range of distances, we noticed that the magnitude of the signal varied from 100 mV to 500 mV. Although we expected our Arduino’s ADC to be able to properly read this signal, the lab required that we built a circuit component so built a non-inverting op-amp with a gain of 11.</p>       
      <img class="imgr borderedbox inspace-5" src="../images/demo/irhardware3.png" alt="">
    </div>
    <!-- ################################################################################################ -->
  </footer>
</div>
   <div class="wrapper row4">
  <footer id="footer" class="hoc clear"> 
    <div class="content">    
      <h1><b>Hardware Procedure</b></h1>
      <p>In this image, the input signal is CH1, the output CH2. These signals have the same period an shape, only differing by a magnitude of ~10. This confirmed our op-amp worked.
After we’d validated both our infrared circuit and op-amp, we connected the output of the circuit of the input of the op-amp and the output of the op-amp to ADC port 1 of the Arduino. 
</p>
      <img class="imgr borderedbox inspace-5" src="../images/demo/irhardware4.png" alt="">
    </div>
    <!-- ################################################################################################ -->
  </footer>
</div>
  <div class="wrapper row4">
  <footer id="footer" class="hoc clear"> 
    <div class="content">    
      <h1><b>Software Procedure</b></h1>
      <p>We first tuned the fft by taking one cycle with no infrared input.
In order to see what buckets corresponded to the IR hat signal, we took another cycle with the IR Hat pointed at the sensor
In order to detect, the 6.08 kHz we put the fft program in a loop and set an if statement for the case that the corresponding buckets had values over a certain threshold. After some brief tuning, our system was able to detect the 6.08 kHz hat and ignore the 18 kHz decoy. When it detected the proper signal, a statement was printed in the serial window. In the future, we will connect this detection logic to our larger project to detect treasures.
</p>
      <p><b>Real IR Detection</b></p>
      <p><b>Unfortunately, files bigger than 25 MB can't be uploaded to Github. Here's a link instead:</b></p>
  <li><a href="https://drive.google.com/file/d/1yOUru3joULqjGydRTBpvrHUCkuta0R84/view?usp=sharing">Real IR Detection</a></li>
  <p>(I will resolve this problem shortly, as soon as I get better wifi than starbucks so I can actually run the pixel reducer online)</p>
      <p><b>Fake IR Non-Detection</b></p>
       <p><b>Unfortunately, files bigger than 25 MB can't be uploaded to Github. Here's a link instead:</b></p>
  <li><a href="https://drive.google.com/file/d/1DVuVu2Gq_pUyzExTCYXcsCnwRVqMjWFe/view?usp=sharing">Fake IR Non-Detection</a></li>
  <p>(I will resolve this problem shortly, as soon as I get better wifi than starbucks so I can actually run the pixel reducer online)</p>
    </div>
    <!-- ################################################################################################ -->
  </footer>
</div>
  </div>
   <div class="wrapper row4">
  <footer id="footer" class="hoc clear"> 
    <div class="content">    
      <h1><b>Final Integrated Working Circuit</b></h1>        
      <<p><b>Unfortunately, files bigger than 25 MB can't be uploaded to Github. Here's a link instead:</b></p>
  <li><a href="https://drive.google.com/open?id=1laB5nNyGdfZGebzD3FZuZBtCscyeabjy">Final Circuit</a></li>
  <p>(I will resolve this problem shortly, as soon as I get better wifi than starbucks so I can actually run the pixel reducer online)</p>
    </div>
    <!-- ################################################################################################ -->
  </footer>
</div>
      <!-- ################################################################################################ -->
    </div>
    <!-- ################################################################################################ -->
    <!-- / main body -->
    <div class="clear"></div>
  </main>
</div>
</div>

<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<div class="wrapper row5">
  <div id="copyright" class="hoc clear"> 
    <!-- ################################################################################################ -->
    <p class="fl_left">Copyright &copy; 2016 - All Rights Reserved - <a href="#">Domain Name</a></p>
    <p class="fl_right">Template by <a target="_blank" href="http://www.os-templates.com/" title="Free Website Templates">OS Templates</a></p>
    <!-- ################################################################################################ -->
  </div>
</div>
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<!-- ################################################################################################ -->
<a id="backtotop" href="#top"><i class="fa fa-chevron-up"></i></a>
<!-- JAVASCRIPTS -->
<script src="../layout/scripts/jquery.min.js"></script>
<script src="../layout/scripts/jquery.backtotop.js"></script>
<script src="../layout/scripts/jquery.mobilemenu.js"></script>
</body>
</html>
